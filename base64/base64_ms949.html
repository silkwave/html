<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Base64 MS949 ë””ì½”ë”©</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 20px;
        padding: 20px;
        background-color: #f4f7f6;
        color: #333;
        line-height: 1.6;
        max-width: 800px;
        margin: 20px auto;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        background-color: #fff;
      }
      h1,
      h3 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 25px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #34495e;
      }
      textarea,
      input[type="file"] {
        width: calc(100% - 22px);
        padding: 10px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
        box-sizing: border-box;
      }
      button {
        background-color: #3498db;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.1rem;
        transition: background-color 0.3s ease;
        width: 100%;
        box-sizing: border-box;
        margin-bottom: 20px;
      }
      button:hover {
        background-color: #2980b9;
      }
      div#message {
        margin-top: 15px;
        padding: 10px;
        border-radius: 5px;
        font-weight: bold;
        text-align: center;
        min-height: 20px; /* Ensure space even when empty */
      }
      div#message[style*="color: red"] {
        background-color: #fdeded;
        color: #e74c3c;
        border: 1px solid #e74c3c;
      }
      div#message[style*="color: green"] {
        background-color: #e8f8f5;
        color: #2ecc71;
        border: 1px solid #2ecc71;
      }
      pre#preview {
        border: 1px solid #ddd;
        padding: 15px;
        white-space: pre-wrap;
        min-height: 180px;
        background-color: #ecf0f1;
        border-radius: 5px;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 0.95rem;
        color: #2c3e50;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>Base64 MS949 ë””ì½”ë”©</h1>

    <!-- git config --list --show-origin -->

    <label>Base64 ë¬¸ìì—´ ì…ë ¥ (MS949 ì¸ì½”ë”© ê¸°ë°˜):</label><br />
    <textarea id="base64Input" rows="6" cols="60">vsiz58fPvLy/5A==</textarea
    ><br />

    <label>íŒŒì¼ ì—…ë¡œë“œ (.c íŒŒì¼ â†’ Base64 ë³€í™˜):</label><br />
    <input type="file" id="fileInput" accept=".c" /><br /><br />

    <button id="decodeBtn">ë””ì½”ë”©í•˜ê¸°</button>

    <div id="message"></div>

    <h3>ğŸ” Base64 ë””ì½”ë”© ë¯¸ë¦¬ë³´ê¸°</h3>
    <pre id="preview">ë””ì½”ë”© ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</pre>

    <script>
      // IDë¡œ DOM ìš”ì†Œë¥¼ ê°€ì ¸ì˜¤ëŠ” í—¬í¼ í•¨ìˆ˜
      const getEl = (id) => document.getElementById(id);

      // ì£¼ìš” DOM ìš”ì†Œë“¤ì„ ë³€ìˆ˜ì— í• ë‹¹
      const base64Input = getEl("base64Input"), // Base64 ì…ë ¥ í…ìŠ¤íŠ¸ ì˜ì—­
        messageEl = getEl("message"), // ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­
        previewEl = getEl("preview"), // ë””ì½”ë”© ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­
        fileInput = getEl("fileInput"), // íŒŒì¼ ì—…ë¡œë“œ ì…ë ¥
        decodeBtn = getEl("decodeBtn"); // ë””ì½”ë”© ì‹¤í–‰ ë²„íŠ¼

      /**
       * ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
       * @param {string} text - í‘œì‹œí•  ë©”ì‹œì§€ ë‚´ìš©
       * @param {boolean} isError - ì˜¤ë¥˜ ë©”ì‹œì§€ ì—¬ë¶€ (trueì´ë©´ ë¹¨ê°„ìƒ‰, falseì´ë©´ ë…¹ìƒ‰)
       */
      const showMessage = (text, isError = false) => {
        messageEl.textContent = text;
        messageEl.style.color = isError ? "red" : "green";
      };

      /**
       * Base64 ë¬¸ìì—´ì„ Uint8Array (ë°”ì´íŠ¸ ë°°ì—´)ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
       * @param {string} base64 - ë³€í™˜í•  Base64 ë¬¸ìì—´
       * @returns {Uint8Array|null} ë³€í™˜ëœ ë°”ì´íŠ¸ ë°°ì—´ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ null
       */
      const base64ToUint8Array = (base64) => {
        try {
          // atob í•¨ìˆ˜ë¡œ Base64 ë¬¸ìì—´ì„ ë°”ì´ë„ˆë¦¬ ë¬¸ìì—´ë¡œ ë””ì½”ë”©
          const binaryString = atob(base64);
          // ë°”ì´ë„ˆë¦¬ ë¬¸ìì—´ì˜ ê° ë¬¸ìë¥¼ char ì½”ë“œë¡œ ë³€í™˜í•˜ì—¬ Uint8Array ìƒì„±
          return Uint8Array.from(binaryString, (char) => char.charCodeAt(0));
        } catch (e) {
          console.error("Base64 decoding error:", e);
          return null; // ë””ì½”ë”© ì‹¤íŒ¨ ì‹œ null ë°˜í™˜
        }
      };

      /**
       * ë°”ì´íŠ¸ ë°°ì—´(Uint8Array)ì„ UTF-8ê³¼ MS949 ì¸ì½”ë”©ìœ¼ë¡œ ê°ê° í•´ì„í•˜ì—¬ ë¬¸ìì—´ë¡œ ë°˜í™˜
       * @param {Uint8Array} bytes - ë””ì½”ë”©í•  ë°”ì´íŠ¸ ë°°ì—´
       * @returns {{utf8: string, ms949: string}} ê° ì¸ì½”ë”©ìœ¼ë¡œ í•´ì„ëœ ë¬¸ìì—´ ê°ì²´
       */
      const decodeBytes = (bytes) => {
        try {
          const utf8Decoder = new TextDecoder("utf-8");
          const ms949Decoder = new TextDecoder("windows-949"); // MS949(CP949) ë””ì½”ë”
          return {
            utf8: utf8Decoder.decode(bytes),
            ms949: ms949Decoder.decode(bytes),
          };
        } catch (e) {
          console.error("Byte decoding error:", e);
          return { utf8: "[ë””ì½”ë”© ì‹¤íŒ¨]", ms949: "[ë””ì½”ë”© ì‹¤íŒ¨]" };
        }
      };

      // 'ë””ì½”ë”©í•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      decodeBtn.onclick = () => {
        showMessage(""); // ì´ì „ ë©”ì‹œì§€ ì´ˆê¸°í™”
        previewEl.textContent = ""; // ì´ì „ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”

        const base64 = base64Input.value.trim(); // ì…ë ¥ëœ Base64 ë¬¸ìì—´ì˜ ì–‘ìª½ ê³µë°± ì œê±°
        if (!base64) return showMessage("Base64 ë¬¸ìì—´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);

        // Base64 ë¬¸ìì—´ì„ ë°”ì´íŠ¸ ë°°ì—´ë¡œ ë³€í™˜
        const bytes = base64ToUint8Array(base64);
        if (!bytes)
          return showMessage(
            "Base64 ë””ì½”ë”© ì‹¤íŒ¨. ìœ íš¨í•œ ë¬¸ìì—´ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.",
            true
          );

        // ë°”ì´íŠ¸ ë°°ì—´ì„ ê° ì¸ì½”ë”©ìœ¼ë¡œ ë””ì½”ë”©
        const decodedResult = decodeBytes(bytes);
        // ê²°ê³¼ë¥¼ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ì— í‘œì‹œ
        previewEl.textContent = `[UTF-8 í•´ì„]\n${decodedResult.utf8}\n\n[MS949 í•´ì„]\n${decodedResult.ms949}`;
        showMessage("ë””ì½”ë”©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      };

      // íŒŒì¼ ì…ë ¥(input) ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      fileInput.onchange = (event) => {
        const file = event.target.files[0]; // ì„ íƒëœ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        if (!file) return;

        const reader = new FileReader(); // íŒŒì¼ ì½ê¸° ìœ„í•œ FileReader ê°ì²´ ìƒì„±
        // íŒŒì¼ ì½ê¸°ê°€ ì™„ë£Œë˜ë©´ ì‹¤í–‰ë  ì½œë°± í•¨ìˆ˜
        reader.onload = (e) => {
          // íŒŒì¼ ë‚´ìš©ì„ ArrayBufferë¡œ ì½ì–´ì™€ Uint8Arrayë¡œ ë³€í™˜
          const fileBytes = new Uint8Array(e.target.result);
          // ë°”ì´íŠ¸ ë°°ì—´ì„ Base64 ë¬¸ìì—´ë¡œ ì¸ì½”ë”©í•˜ì—¬ ì…ë ¥ë€ì— ì„¤ì •
          base64Input.value = btoa(String.fromCharCode(...fileBytes));
          showMessage("íŒŒì¼ì´ Base64ë¡œ ë³€í™˜ë˜ì–´ ì…ë ¥ë€ì— ì‚½ì…ë˜ì—ˆìŠµë‹ˆë‹¤.");
        };
        // íŒŒì¼ì„ ArrayBuffer í˜•íƒœë¡œ ì½ê¸° ì‹œì‘
        reader.readAsArrayBuffer(file);
      };
    </script>
  </body>
</html>
