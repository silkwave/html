<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dev Dark — Refactored</title>
  <style>
    /* =======================
       CSS 변수 정의 (iOS 스타일)
       ======================= */
    :root {
      --bg-light: #f5f5f7;
      --bg-dark: #000000;
      --card-light: #ffffff;
      --card-dark: #1c1c1e;
      --accent: #007AFF;
      --accent-light: #e8f4ff;
      --muted: #86868b;
      --separator: #e0e0e2;
      --separator-dark: #424245;
      --text-primary-light: #000000;
      --text-primary-dark: #ffffff;
      --text-secondary-light: #86868b;
      --text-secondary-dark: #8e8e93;
    }

    /* =======================
       기본 스타일 (iOS 스타일)
       ======================= */
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Arial, Verdana, sans-serif;
      letter-spacing: -0.01em;
    }
    body {
      background: var(--bg-light);
      color: var(--text-primary-light);
    }

    /* =======================
       시스템 다크모드 감지
       ======================= */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-light: #000000;
        --card-light: #1c1c1e;
        --text-primary-light: #ffffff;
        --muted: #8e8e93;
        --separator: #424245;
      }
      body {
        background: var(--bg-dark);
        color: var(--text-primary-dark);
      }
      .site-card {
        background: var(--card-dark);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      }
      .site-card h3 {
        color: var(--text-primary-dark);
      }
      .card-input {
        background: #2c2c2e;
        border-color: var(--separator-dark);
        color: var(--text-primary-dark);
      }
      .link-button {
        border-bottom-color: var(--separator-dark);
      }
      .link-button:hover {
        background-color: rgba(0, 122, 255, 0.35);
        color: #ffffff;
      }
      .link-button:active {
        background-color: rgba(0, 122, 255, 0.5);
        color: #ffffff;
      }
    }

    /* =======================
       사이트 카드 래퍼 (기본)
       ======================= */
    .site-wrapper {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 600px;
      margin: 80px auto 100px;
      padding: 0 16px;
    }

    /* =======================
       모두보기 모드 (wrap 레이아웃)
       ======================= */
    .site-wrapper.show-all {
      flex-direction: row;
      flex-wrap: wrap;
      max-width: 100%;
      justify-content: center;
      gap: 20px;
      padding: 0 20px;
      margin: 80px auto 100px;
    }

    .site-wrapper.show-all .site-card {
      flex: 1 1 calc(50% - 20px);
      max-width: 400px;
    }
    

    .site-wrapper.crop-mode .site-card:first-child {
      border-radius: 36px 0 0 36px;
    }

    /* =======================
       카드 스타일 (iOS 카드)
       ======================= */
    .site-card {
      padding: 20px;
      border-radius: 20px;
      text-align: left;
      background: var(--card-light);
      border: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .site-card:active {
      transform: scale(0.98);
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
    }

    .site-card h3 {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 6px 0;
      color: var(--text-primary-light);
    }
    .site-card p {
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 16px 0;
      line-height: 1.5;
    }

    /* =======================
       카드 메모 영역 (iOS 텍스트 필드)
       ======================= */
    .card-input {
      width: 100%;
      padding: 12px 14px;
      margin: 12px 0;
      border-radius: 12px;
      font-family: 'Segoe UI', Tahoma, Arial, monospace;
      font-size: 14px;
      height: 80px;
      resize: none;
      border: 1px solid var(--separator);
      background: var(--bg-light);
      color: var(--text-primary-light);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .card-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    /* =======================
       링크 버튼 리스트 (iOS 버튼)
       ======================= */
    .link-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .link-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      padding: 8px 10px;
      border: none;
      text-decoration: none;
      text-align: left;
      background: transparent;
      color: var(--accent);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s ease;
      border-radius: 12px;
      border-bottom: 1px solid var(--separator);
      -webkit-user-select: none;
      user-select: none;
    }

    .link-button:last-child {
      border-bottom: none;
    }

    .link-button:hover {
      background-color: rgba(0, 122, 255, 0.4);
      color: #ffffff;
    }

    .link-button:active {
      background-color: rgba(0, 122, 255, 0.55);
      color: #ffffff;
    }

    .link-button::after {
      content: '›';
      font-size: 20px;
      color: var(--muted);
      margin-left: 8px;
    }

    /* =======================
       카드 캐러셀 버튼 (iOS 하단 컨트롤)
       ======================= */
    #cardControls {
      position: fixed;
      left: 16px;
      bottom: 20px;
      right: 16px;
      display: flex;
      gap: 10px;
      z-index: 40;
      max-width: calc(600px - 32px);
      margin-left: auto;
      margin-right: auto;
    }
    #cardControls button {
      flex: 1;
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      border: none;
      background: var(--accent);
      color: #ffffff;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      -webkit-user-select: none;
      user-select: none;
    }

    #cardControls button:active {
      transform: scale(0.98);
      opacity: 0.8;
    }

    #cardControls button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* =======================
       모바일 최적화
       ======================= */
    @media (max-width: 768px) {
      .site-wrapper {
        max-width: 100%;
        margin: 70px auto 120px;
      }
      .site-wrapper.show-all {
        flex-direction: column;
        max-width: 600px;
      }
      .site-wrapper.show-all .site-card {
        flex: 1 1 100%;
        max-width: 100%;
      }
      #cardControls {
        left: 16px;
        right: 16px;
        max-width: none;
      }
    }

    /* =======================
       Safe Area (노치 대응)
       ======================= */
    @supports (padding: max(0px)) {
      body {
        padding-left: max(0px, env(safe-area-inset-left));
        padding-right: max(0px, env(safe-area-inset-right));
      }
      #cardControls {
        left: max(16px, env(safe-area-inset-left));
        right: max(16px, env(safe-area-inset-right));
      }
    }
  </style>
</head>
<body>
    <!-- 카드 캐러셀 버튼 -->
    <div id="cardControls">
        <button id="prevCard">◀ 이전</button>
        <button id="nextCard">다음 ▶</button>
        <button id="toggleAll" aria-pressed="false">모두 보기</button>
    </div>

    <!-- 메인 콘텐츠 -->
    <main class="site-wrapper">
        <!-- Dev Sites -->
        <section class="site-card">
            <h3>개발 Sites</h3>
            <p>개발 및 프로그래밍에 유용한 링크들입니다.</p>
            <ul class="link-list">
                <li><a class="link-button" href="https://www.google.co.kr/" target="_blank" rel="noopener">구글</a></li>
                <li><a class="link-button" href="https://www.youtube.com/" target="_blank" rel="noopener">유튜브</a></li>
                <li><a class="link-button" href="https://mvnrepository.com/" target="_blank" rel="noopener">Maven</a></li>
                <li><a class="link-button" href="https://www.github.com/" target="_blank" rel="noopener">GitHub</a></li>
                <li><a class="link-button" href="https://www.stackoverflow.com/" target="_blank" rel="noopener">Stack Overflow</a></li>
            </ul>
            <textarea class="card-input" placeholder="메모 또는 링크 추가..." aria-label="개발 Sites memo"></textarea>            
        </section>

        <!-- 품질 Sites -->
        <section class="site-card">
            <h3>품질 Sites</h3>
            <p>추가적인 개발 리소스와 도구 링크들입니다.</p>
            <ul class="link-list">
                <li><a class="link-button" href="https://www.sonarqube.org/" target="_blank" rel="noopener">SonarQube</a></li>
                <li><a class="link-button" href="https://www.jenkins.io/" target="_blank" rel="noopener">Jenkins</a></li>
                <li><a class="link-button" href="https://snyk.io/" target="_blank" rel="noopener">Snyk</a></li>
                <li><a class="link-button" href="https://www.selenium.dev/" target="_blank" rel="noopener">Selenium</a></li>
            </ul>
            <textarea class="card-input" placeholder="메모 또는 링크 추가..." aria-label="품질 Sites memo"></textarea>            
        </section>

        <!-- 운영 Sites -->
        <section class="site-card">
            <h3>운영 Sites</h3>
            <p>프로그래밍 학습 및 참조 사이트 모음입니다.</p>
            <ul class="link-list">
                <li><a class="link-button" href="https://grafana.com/" target="_blank" rel="noopener">Grafana</a></li>
                <li><a class="link-button" href="https://prometheus.io/" target="_blank" rel="noopener">Prometheus</a></li>
                <li><a class="link-button" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS Console</a></li>
                <li><a class="link-button" href="https://cloud.google.com/console/" target="_blank" rel="noopener">GCP Console</a></li>
                <li><a class="link-button" href="https://www.datadoghq.com/" target="_blank" rel="noopener">Datadog</a></li>
            </ul>
            <textarea class="card-input" placeholder="메모 또는 링크 추가..." aria-label="운영 Sites memo"></textarea>            
        </section>
    </main>

    <script>
        // =======================
        // 카드 캐러셀 기능
        // =======================
        (function() {
          const cards = Array.from(document.querySelectorAll('.site-card'));
          let index = 0;
          const prevBtn = document.getElementById('prevCard');
          const nextBtn = document.getElementById('nextCard');
          const toggleAll = document.getElementById('toggleAll');
          const wrapper = document.querySelector('.site-wrapper');
          let showAll = false;

          function updateView() {
            if (showAll) {
              // showAll이 true: 모든 카드 표시 (wrap 레이아웃)
              wrapper.classList.add('show-all');
              wrapper.style.display = 'flex';
              cards.forEach(c => c.style.display = 'block');
              
              // Prev/Next 버튼 비활성화
              prevBtn.disabled = true;
              nextBtn.disabled = true;
              toggleAll.setAttribute('aria-pressed','true');
              toggleAll.textContent = '단일 보기';
            } else {
              // showAll이 false: 현재 인덱스 카드만 표시
              wrapper.classList.remove('show-all');
              wrapper.style.display = 'block';
              cards.forEach((c, i) => {
                c.style.display = i === index ? 'block' : 'none';
              });
              
              // 인덱스에 따라 Prev/Next 버튼 활성화/비활성화
              prevBtn.disabled = index === 0;
              nextBtn.disabled = index === cards.length - 1;
              toggleAll.setAttribute('aria-pressed','false');
              toggleAll.textContent = '모두 보기';
            }
          }

          prevBtn.addEventListener('click', () => { if (index > 0) { index--; updateView(); } });
          nextBtn.addEventListener('click', () => { if (index < cards.length - 1) { index++; updateView(); } });
          toggleAll.addEventListener('click', () => { showAll = !showAll; updateView(); });
          document.addEventListener('keydown', (e) => {
              if (showAll || document.activeElement.tagName === 'TEXTAREA') return;
              if (e.key === 'ArrowLeft') { prevBtn.click(); }
              if (e.key === 'ArrowRight') { nextBtn.click(); }
          });

          updateView();
        })();

        // =======================
        // 카드 메모 로컬스토리지 저장 (디바운스)
        // =======================
        function bindDebouncedSave(el, key, delay=300) {
          el.value = localStorage.getItem(key) || "";
          let tid;
          el.addEventListener("input", () => {
            clearTimeout(tid);
            tid = setTimeout(() => localStorage.setItem(key, el.value), delay);
          });
        }
        document.querySelectorAll(".card-input").forEach((el,i) => {
            const cardTitle = el.closest('.site-card').querySelector('h3').textContent;
            bindDebouncedSave(el, `card-memo-${cardTitle}`);
            el.setAttribute('aria-label', `${cardTitle} memo`);
        });
    </script>
</body>
</html>