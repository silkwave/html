<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SQL 생성기</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: auto;
      }
      .btn-group {
        display: flex;
        gap: 10px;
      }
      label {
        font-weight: bold;
        margin-top: 12px;
        display: block;
      }
      input,
      textarea,
      button {
        width: 100%;
        box-sizing: border-box;
        padding: 10px;
        margin-top: 5px;
        font-size: 16px;
      }
      textarea {
        min-height: 300px;
        resize: vertical;
      }
      #output {
        min-height: 350px;
        background: #222;
        color: #0f0;
        font-family: Consolas, monospace;
        border-radius: 4px;
        padding: 15px;
      }
      button {
        margin-top: 15px;
        font-size: 18px;
        padding: 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      .btn-primary {
        background: #0066ff;
        color: white;
      }
      .btn-secondary {
        background: #555;
        color: white;
      }
      #status-message {
        margin-top: 15px;
        padding: 12px;
        border-radius: 4px;
        font-weight: bold;
        display: none;
      }
      #status-message.success {
        background-color: #d4edda;
        color: #155724;
        display: block;
      }
      #status-message.error {
        background-color: #f8d7da;
        color: #721c24;
        display: block;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h2>SQL 생성기</h2>

      <label for="tableNameInput">테이블명</label>
      <input type="text" id="tableNameInput" value="BOARD" />

      <label for="pkColumnsInput">PK 컬럼 (UPDATE용, 콤마로 구분)</label>
      <input type="text" id="pkColumnsInput" value="BOARD_ID" />

      <label for="inputData">데이터 입력 (Excel 붙여넣기 지원)</label>
      <textarea id="inputData">
"BOARD_ID" "TITLE" "CONTENTS" "HIT_CNT" "DEL_YN" "CRTR_ID" "CRTE_DT" "UPDT_ID" "UPDT_DT"
1 "제목1" "내용1" 10 "N" "user1" "2025-11-15" "user1" "2025-11-15"
2 "제목2" "내용2" 20 "N" "user2" "2025-11-15" "user2" "2025-11-15"
    </textarea>

      <div class="btn-group">
        <button class="btn-primary" id="generateInsertBtn">INSERT 생성</button>
        <button class="btn-primary" id="generateUpdateBtn">UPDATE 생성</button>
        <button class="btn-secondary" id="copyBtn">복사</button>
      </div>

      <label for="output">출력 결과</label>
      <textarea id="output" readonly></textarea>

      <div id="status-message"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const getEl = (id) => document.getElementById(id);

        const ui = {
          tableName: getEl("tableNameInput"),
          pkColumns: getEl("pkColumnsInput"),
          inputData: getEl("inputData"),
          output: getEl("output"),
          status: getEl("status-message"),
          generateInsertBtn: getEl("generateInsertBtn"),
          generateUpdateBtn: getEl("generateUpdateBtn"),
          copyBtn: getEl("copyBtn"),
        };

        const showStatus = (message, isError = false) => {
          ui.status.textContent = message;
          ui.status.className = isError ? "error" : "success";
        };

        const detectDate = (value) => {
          const dateFormats = [
            { regex: /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/, format: "YYYY-MM-DD HH24:MI:SS" },
            { regex: /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/, format: "YYYY-MM-DD HH24:MI" },
            { regex: /^\d{4}-\d{2}-\d{2}$/, format: "YYYY-MM-DD" },
            { regex: /^\d{2}\/\d{2}\/\d{2}$/, format: "YY/MM/DD" },
          ];
          for (const df of dateFormats) {
            if (df.regex.test(value)) {
              return `TO_DATE('${value}', '${df.format}')`;
            }
          }
          return null;
        };

        const formatValue = (raw) => {
          if (raw == null || raw.trim() === "" || raw.trim().toLowerCase() === 'null') {
            return "NULL";
          }
          let value = raw.trim().replace(/^"|"$/g, "");
          const detectedDate = detectDate(value);
          if (detectedDate) return detectedDate;
          
          if (!isNaN(value) && value.trim() !== "") {
            return value;
          }
          
          return `'${value.replace(/'/g, "''")}'`;
        };

        const parseInput = () => {
          const lines = ui.inputData.value.trim().split("\n").map(v => v.trim()).filter(Boolean);
          if (lines.length < 2) {
            showStatus("컬럼과 최소 한 줄의 데이터가 필요합니다.", true);
            return null;
          }
          const columns = (lines[0].match(/"[^" ]*"|\S+/g) || []).map(c => c.replace(/^"|"$/g, ""));
          const rows = lines.slice(1).map(row => row.match(/"[^" ]*"|\S+/g) || []);
          return { columns, rows };
        };

        const generateInsert = () => {
          const tableName = ui.tableName.value.trim();
          if (!tableName) {
            showStatus("테이블명을 입력하세요.", true);
            return;
          }
          const parsed = parseInput();
          if (!parsed) return;

          const { columns, rows } = parsed;
          const sqlList = rows.map(row => {
            const values = columns.map((_, i) => formatValue(row[i] || ""));
            return `INSERT INTO ${tableName} (${columns.join(", ")})\nVALUES (${values.join(", ")});`;
          });

          ui.output.value = sqlList.join("\n\n");
          showStatus("INSERT 문 생성 완료!");
        };

        const generateUpdate = () => {
          const tableName = ui.tableName.value.trim();
          if (!tableName) {
            showStatus("테이블명을 입력하세요.", true);
            return;
          }
          const pkNames = ui.pkColumns.value.trim().split(',').map(pk => pk.trim()).filter(Boolean);
          if (pkNames.length === 0) {
            showStatus("PK 컬럼을 입력하세요.", true);
            return;
          }
          const parsed = parseInput();
          if (!parsed) return;

          const { columns, rows } = parsed;
          const pkIndices = pkNames.map(pkName => columns.indexOf(pkName));

          if (pkIndices.some(index => index === -1)) {
            showStatus("입력한 PK 컬럼이 데이터에 존재하지 않습니다.", true);
            return;
          }

          const sqlList = rows.map(row => {
            const setClauses = [];
            const whereClauses = [];

            columns.forEach((col, i) => {
              const value = formatValue(row[i] || "");
              if (pkIndices.includes(i)) {
                whereClauses.push(`${col} = ${value}`);
              } else {
                setClauses.push(`${col} = ${value}`);
              }
            });
            
            if (whereClauses.length === 0) return null;

            return `UPDATE ${tableName} SET\n  ${setClauses.join(",\n  ")}\nWHERE ${whereClauses.join(" AND ")};`;
          }).filter(Boolean);
          
          if(sqlList.length === 0){
             showStatus("UPDATE 문을 생성할 수 없습니다. PK 값을 확인하세요.", true);
             ui.output.value = "";
             return;
          }

          ui.output.value = sqlList.join("\n\n");
          showStatus("UPDATE 문 생성 완료!");
        };

        const copySql = () => {
          if (!ui.output.value.trim()) return;
          navigator.clipboard.writeText(ui.output.value).then(() => {
            showStatus("복사 완료!");
          });
        };

        ui.generateInsertBtn.addEventListener("click", generateInsert);
        ui.generateUpdateBtn.addEventListener("click", generateUpdate);
        ui.copyBtn.addEventListener("click", copySql);
      });
    </script>
  </body>
</html>